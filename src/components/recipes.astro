---
import '../styles/global.css';

const {name, image, ingredients, steps} = Astro.props;
const id = name.replace(/\s+/g, "-").toLowerCase();
---


<!-- CARD -->
<div 
  class="cursor-pointer rounded-xl overflow-hidden shadow hover:shadow-lg transition"
  onclick={`openModal('${id}')`}
>
  <img src={image} alt={name} class="w-full h-48 object-cover" />
  <div class="p-4">
    <h3 class="text-lg font-semibold text-white">{name}</h3>
  </div>
</div>

<!-- MODAL BACKDROP -->
<div
  id={`modal-${id}`}
  class="hidden opacity-0 transition-opacity duration-300 fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4"
  onclick={`backdropClose('${id}', event)`}
>
  <!-- MODAL BOX -->
  <div 
    class="bg-white rounded-xl max-w-lg w-full p-6 relative overflow-y-auto max-h-[90vh]"
    onclick="event.stopPropagation()"
  >
    <button
      class="absolute top-3 right-3 text-gray-500 hover:text-gray-700"
      onclick={`closeModal('${id}')`}
    >
      âœ•
    </button>

    <h2 class="text-2xl font-bold mb-4">{name}</h2>
    <img src={image} alt={name} class="rounded-lg mb-4 w-full h-56 object-cover" />

    <h3 class="font-semibold text-lg mb-2">Bahan:</h3>
    <ul class="list-disc list-inside space-y-1 mb-4">
      {ingredients.map((i: string) => (
        <li>{i}</li>
      ))}
    </ul>

    <h3 class="font-semibold text-lg mb-2">Cara Membuat:</h3>
    <ol class="list-decimal list-inside space-y-1">
      {steps.map((s: string) => (
        <li>{s}</li>
      ))}
    </ol>
  </div>
</div>

<script is:inline>
  function openModal(id) {
    const el = document.getElementById(`modal-${id}`);
    if (!el) return;

    el.classList.remove("hidden");
    requestAnimationFrame(() => {
      el.classList.remove("opacity-0");
      el.classList.add("opacity-100");
    });
  }

  function closeModal(id) {
    const el = document.getElementById(`modal-${id}`);
    if (!el) return;

    el.classList.remove("opacity-100");
    el.classList.add("opacity-0");

    setTimeout(() => {
      el.classList.add("hidden");
    }, 300);
  }

  function backdropClose(id, event) {
    const modal = document.getElementById(`modal-${id}`);
    if (!modal) return;

    if (event.target === modal) {
      closeModal(id);
    }
  }
</script>